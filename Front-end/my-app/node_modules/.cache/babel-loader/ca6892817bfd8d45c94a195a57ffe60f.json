{"ast":null,"code":"import _slicedToArray from\"C:/Users/louis/Documents/info/S3/UE3/M3301/rendus/Front-end/my-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"C:/Users/louis/Documents/info/S3/UE3/M3301/rendus/Front-end/my-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";function _templateObject3(){var data=_taggedTemplateLiteral([\"\\n  border: 1px solid blue;\\n  width: 50%;\\n  height: 50%;\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  display: flex;\\n  width: 100%;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  height: 100vh;\\n  width: 100%;\\n  display: flex;\\n  flex-direction: column;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useEffect,useState,useRef}from'react';import'./Room.css';import io from\"socket.io-client\";import Peer from\"simple-peer\";import styled from\"styled-components\";import Chat from\"./Chat/Chat\";import authService from'../services/auth.service';var Container=styled.div(_templateObject());var Row=styled.div(_templateObject2());var Video=styled.video(_templateObject3());function Room(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),yourID=_useState2[0],setYourID=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),users2=_useState4[0],setUsers=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),stream=_useState6[0],setStream=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),receivingCall=_useState8[0],setReceivingCall=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),caller=_useState10[0],setCaller=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),callerSignal=_useState12[0],setCallerSignal=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),callAccepted=_useState14[0],setCallAccepted=_useState14[1];var userVideo=useRef();var partnerVideo=useRef();var socket=useRef();useEffect(function(){socket.current=io.connect(\"https://lingopeerbe.herokuapp.com/\");var user=authService.getCurrentUser();var room=user.room;navigator.mediaDevices.getUserMedia({video:true,audio:true}).then(function(stream){setStream(stream);if(userVideo.current){userVideo.current.srcObject=stream;}});socket.current.on('test',function(){console.log(\"le test passe\");});/*socket.current.on('yourID', (id) => {\r\n      setYourID(id);\r\n      console.log(id);\r\n    })*/socket.current.on('allUsers',function(users2){setUsers(users2);console.log(users2);});socket.current.on('yourName',function(name){setYourID(name);console.log(yourID);});socket.current.on('hey',function(data){setReceivingCall(true);setCaller(data.from);setCallerSignal(data.signal);});},[]);function callPeer(id){var peer=new Peer({initiator:true,trickle:false,stream:stream});peer.on(\"signal\",function(data){socket.current.emit(\"callUser\",{userToCall:id,signalData:data,from:yourID});});peer.on(\"stream\",function(stream){if(partnerVideo.current){partnerVideo.current.srcObject=stream;}});socket.current.on(\"callAccepted\",function(signal){setCallAccepted(true);peer.signal(signal);});}function acceptCall(){setCallAccepted(true);var peer=new Peer({initiator:false,trickle:false,stream:stream});peer.on(\"signal\",function(data){socket.current.emit(\"acceptCall\",{signal:data,to:caller});});peer.on(\"stream\",function(stream){partnerVideo.current.srcObject=stream;});peer.signal(callerSignal);}var UserVideo;if(stream){UserVideo=/*#__PURE__*/_jsx(Video,{playsInline:true,muted:true,hidden:true,ref:userVideo,autoPlay:true});}var PartnerVideo;if(callAccepted){UserVideo=/*#__PURE__*/_jsx(Video,{playsInline:true,muted:true,ref:userVideo,autoPlay:true});PartnerVideo=/*#__PURE__*/_jsx(Video,{playsInline:true,ref:partnerVideo,autoPlay:true});}var incomingCall;if(receivingCall){incomingCall=/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h1\",{children:[caller,\" is calling you\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:acceptCall,children:\"Accept\"})]});}return/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Conversation\"}),/*#__PURE__*/_jsxs(Row,{children:[UserVideo,PartnerVideo]}),/*#__PURE__*/_jsx(Chat,{}),/*#__PURE__*/_jsx(Row,{children:Object.keys(users2).map(function(key){if(key===yourID){return null;}return/*#__PURE__*/_jsxs(\"button\",{onClick:function onClick(){return callPeer(key);},children:[\"Call \",key]});})}),/*#__PURE__*/_jsx(Row,{children:incomingCall})]});}export default Room;","map":{"version":3,"sources":["C:/Users/louis/Documents/info/S3/UE3/M3301/rendus/Front-end/my-app/src/components/Room.component.js"],"names":["React","useEffect","useState","useRef","io","Peer","styled","Chat","authService","Container","div","Row","Video","video","Room","yourID","setYourID","users2","setUsers","stream","setStream","receivingCall","setReceivingCall","caller","setCaller","callerSignal","setCallerSignal","callAccepted","setCallAccepted","userVideo","partnerVideo","socket","current","connect","user","getCurrentUser","room","navigator","mediaDevices","getUserMedia","audio","then","srcObject","on","console","log","name","data","from","signal","callPeer","id","peer","initiator","trickle","emit","userToCall","signalData","acceptCall","to","UserVideo","PartnerVideo","incomingCall","Object","keys","map","key"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\r\nimport './Room.css';\r\nimport io from \"socket.io-client\";\r\nimport Peer from \"simple-peer\";\r\nimport styled from \"styled-components\";\r\nimport Chat from \"./Chat/Chat\";\r\nimport authService from '../services/auth.service';\r\n\r\nconst Container = styled.div`\r\n  height: 100vh;\r\n  width: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n`;\r\n\r\nconst Row = styled.div`\r\n  display: flex;\r\n  width: 100%;\r\n`;\r\n\r\nconst Video = styled.video`\r\n  border: 1px solid blue;\r\n  width: 50%;\r\n  height: 50%;\r\n`;\r\n\r\nfunction Room() {\r\n  const [yourID, setYourID] = useState(\"\");\r\n  const [users2, setUsers] = useState({});\r\n  const [stream, setStream] = useState();\r\n  const [receivingCall, setReceivingCall] = useState(false);\r\n  const [caller, setCaller] = useState(\"\");\r\n  const [callerSignal, setCallerSignal] = useState();\r\n  const [callAccepted, setCallAccepted] = useState(false);\r\n\r\n  const userVideo = useRef();\r\n  const partnerVideo = useRef();\r\n  const socket = useRef();\r\n\r\n  useEffect(() => {\r\n    socket.current = io.connect(\"https://lingopeerbe.herokuapp.com/\");\r\n\r\n    const user = authService.getCurrentUser();\r\n    const room = user.room;\r\n\r\n    navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {\r\n      setStream(stream);\r\n      if (userVideo.current) {\r\n        userVideo.current.srcObject = stream;\r\n      }\r\n    })\r\n\r\n    socket.current.on('test', () => {\r\n      console.log(\"le test passe\");\r\n    })\r\n\r\n    /*socket.current.on('yourID', (id) => {\r\n      setYourID(id);\r\n      console.log(id);\r\n    })*/\r\n\r\n    socket.current.on('allUsers', (users2) => {\r\n      setUsers(users2);\r\n      console.log(users2);\r\n    })\r\n    socket.current.on('yourName', (name) => {\r\n      setYourID(name);\r\n      console.log(yourID);\r\n    })\r\n\r\n    socket.current.on('hey', (data) => {\r\n      setReceivingCall(true);\r\n      setCaller(data.from);\r\n      setCallerSignal(data.signal);\r\n    })\r\n  }, []);\r\n\r\n  function callPeer(id) {\r\n    const peer = new Peer({\r\n      initiator: true,\r\n      trickle: false,\r\n      stream: stream,\r\n    });\r\n\r\n    peer.on(\"signal\", data => {\r\n      socket.current.emit(\"callUser\", { userToCall: id, signalData: data, from: yourID })\r\n    })\r\n\r\n    peer.on(\"stream\", stream => {\r\n      if (partnerVideo.current) {\r\n        partnerVideo.current.srcObject = stream;\r\n      }\r\n    });\r\n\r\n    socket.current.on(\"callAccepted\", signal => {\r\n      setCallAccepted(true);\r\n      peer.signal(signal);\r\n    })\r\n\r\n  }\r\n\r\n  function acceptCall() {\r\n    setCallAccepted(true);\r\n    const peer = new Peer({\r\n      initiator: false,\r\n      trickle: false,\r\n      stream: stream,\r\n    });\r\n    peer.on(\"signal\", data => {\r\n      socket.current.emit(\"acceptCall\", { signal: data, to: caller })\r\n    })\r\n\r\n    peer.on(\"stream\", stream => {\r\n      partnerVideo.current.srcObject = stream;\r\n    });\r\n\r\n    peer.signal(callerSignal);\r\n  }\r\n\r\n  let UserVideo;\r\n  if (stream){\r\n    UserVideo = (\r\n      <Video playsInline muted hidden ref={userVideo} autoPlay />\r\n    );\r\n  }\r\n\r\n  let PartnerVideo;\r\n  if (callAccepted) {\r\n    UserVideo = (\r\n      <Video playsInline muted ref={userVideo} autoPlay />\r\n    );\r\n    PartnerVideo = (\r\n      <Video playsInline ref={partnerVideo} autoPlay />\r\n    );\r\n  }\r\n\r\n  let incomingCall;\r\n  if (receivingCall) {\r\n    incomingCall = (\r\n      <div>\r\n        <h1>{caller} is calling you</h1>\r\n        <button onClick={acceptCall}>Accept</button>\r\n      </div>\r\n    )\r\n  }\r\n  return (\r\n    <Container>\r\n    <h1>Conversation</h1>\r\n      <Row>\r\n        {UserVideo}\r\n        {PartnerVideo}\r\n      </Row>\r\n      <Chat/>\r\n      <Row>\r\n        {Object.keys(users2).map(key => {\r\n          if (key === yourID) {\r\n            return null;\r\n          }\r\n          return (\r\n            <button onClick={() => callPeer(key)}>Call {key}</button>\r\n          );\r\n        })}\r\n      </Row>\r\n      <Row>\r\n        {incomingCall}\r\n      </Row>\r\n    </Container>\r\n  );\r\n}\r\n\r\nexport default Room;\r\n"]},"metadata":{},"sourceType":"module"}